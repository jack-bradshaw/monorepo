#!/bin/bash
# Wrapper script to select the correct Bazelisk binary for the current platform.

OS=$(uname -s | tr '[:upper:]' '[:lower:]')
ARCH=$(uname -m)

SCRIPT_DIR=$(dirname "$0")

if [[ "$OS" == "linux" ]]; then
  if [[ "$ARCH" == "x86_64" ]]; then
    exec "$SCRIPT_DIR/bin/bazelisk-linux-x86_64" "$@"
  elif [[ "$ARCH" == "aarch64" ]]; then
    exec "$SCRIPT_DIR/bin/bazelisk-linux-arm64" "$@"
  fi
elif [[ "$OS" == "darwin" ]]; then
  if [[ "$ARCH" == "x86_64" ]]; then
    exec "$SCRIPT_DIR/bin/bazelisk-darwin-x86_64" "$@"
  elif [[ "$ARCH" == "arm64" ]]; then
    exec "$SCRIPT_DIR/bin/bazelisk-darwin-arm64" "$@"
  fi
fi

echo "Unable to run bazelisk on this platform."
echo "No binary found in $SCRIPT_DIR/bin for: $OS-$ARCH."
echo "Available binaries:"
ls "$SCRIPT_DIR/bin"

exit 1
