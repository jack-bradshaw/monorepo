load("@platforms//host:constraints.bzl", "HOST_CONSTRAINTS")
load("@aspect_bazel_lib//lib/private:bats_toolchain.bzl", "bats_toolchain")
load("@aspect_bazel_lib//lib:copy_to_directory.bzl", "copy_to_directory")

copy_to_directory(
    name = "core",
    hardlink = "on",
    srcs = glob([
        "lib/**",
        "libexec/**"
    ]) + ["bin/bats"],
    out = "bats-core",
)

bats_toolchain(
    name = "toolchain",
    core = ":core",
    libraries = ["@bats_support//:support", "@bats_assert//:assert", "@bats_file//:file"]
)

toolchain(
    name = "bats_toolchain",
    exec_compatible_with = HOST_CONSTRAINTS,
    toolchain = ":toolchain",
    toolchain_type = "@aspect_bazel_lib//lib:bats_toolchain_type",
)
